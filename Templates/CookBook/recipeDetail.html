{% extends 'CookBook/base.html' %}

{% block title %}Recipe Details - CookBook{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <a href="{% url 'CookBook:home' %}" class="btn btn-outline-secondary mb-3">
            <i class="bi bi-arrow-left"></i> Back
        </a>
        
        <h1 class="display-5">{{ recipe.title }}</h1>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header">
                <div class="d-flex gap-2">
                    {% if recipe.type == 'Veg' %}
                        <span class="badge bg-success">{{ recipe.type }}</span>
                    {% elif recipe.type == 'Non-Veg' %}
                        <span class="badge bg-danger">{{ recipe.type }}</span>
                    {% elif recipe.type == 'Vegan' %}
                        <span class="badge bg-info">{{ recipe.type }}</span>
                    {% else %}
                        <span class="badge bg-warning">{{ recipe.type }}</span>
                    {% endif %}
                    {% if recipe.category %}
                        <span class="badge bg-secondary">{{ recipe.category }}</span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Ingredients -->
            <div class="card-body">
                <h4 class="mb-3">
                    <i class="bi bi-egg"></i> Ingredients ({{ recipe.ingredients|length }})
                </h4>
                <ul class="list-group list-group-flush">
                    {% for ingredient in recipe.ingredients %}
                    <li class="list-group-item">
                        <i class="bi bi-check-circle text-success"></i> {{ ingredient }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            
            <!-- Method -->
            {% if recipe.method %}
            <div class="card-body border-top">
                <h4 class="mb-3">
                    <i class="bi bi-list-ol"></i> Cooking Method
                </h4>
                <ol class="list-group list-group-numbered">
                    {% for step in recipe.method %}
                    <li class="list-group-item">{{ step }}</li>
                    {% endfor %}
                </ol>
            </div>
            {% endif %}
            
            <!-- Tips -->
            {% if recipe.tips %}
            <div class="card-body border-top">
                <h4 class="mb-3">
                    <i class="bi bi-lightbulb"></i> Chef's Tips
                </h4>
                <div class="alert alert-info">
                    <ul class="mb-0">
                        {% for tip in recipe.tips %}
                        <li>{{ tip }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
            
            <div class="card-footer">
                <button class="btn btn-success btn-lg" onclick="selectThisRecipe()">
                    <i class="bi bi-plus-circle"></i> Add to Grocery List
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Recipe Summary</h6>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <strong>Type:</strong> {{ recipe.type|default:"Not specified" }}
                </li>
                <li class="list-group-item">
                    <strong>Category:</strong> {{ recipe.category|default:"Not specified" }}
                </li>
                <li class="list-group-item">
                    <strong>Ingredients:</strong> {{ recipe.ingredients|length }}
                </li>
                <li class="list-group-item">
                    <strong>Steps:</strong> {{ recipe.method|length }}
                </li>
            </ul>
        </div>
    </div>
</div>

<script>
function selectThisRecipe() {
    fetch('{% url "CookBook:select_recipe" recipe.id %}', {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            window.location.href = '{% url "CookBook:selected_recipes" %}';
        }
    })
    .catch(error => console.error('Error:', error));
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}
